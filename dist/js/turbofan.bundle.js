var t={apiHost:turbofanSettings.apiHost||"https://api.turbofan.email",confirmationPathname:turbofanSettings.confirmationPathname||"/signup-confirmed/",formSelector:turbofanSettings.formSelector||"#turbofan-form",formSuccessMsgSelector:turbofanSettings.formSuccessMsgSelector||"#turbofan-form .success-msg",formErrorMsgSelector:turbofanSettings.formErrorMsgSelector||"#turbofan-form .error-msg",formInboxLinkSelector:turbofanSettings.formInboxLinkSelector||"#turbofan-form .inbox-link",formSpinnerSelector:turbofanSettings.formSpinnerSelector||"#turbofan-form .spinner",confirmErrorMsgSelector:turbofanSettings.confirmErrorMsgSelector||"#turbofan-confirm .error-msg",hiddenClass:turbofanSettings.hiddenClass||"turbofan-hidden",dryRun:turbofanSettings.dryRun||!1},S=[{name:"gmail",domains:["gmail.com","googlemail.com"],inboxUrl:"https://mail.google.com/mail/u/0/#inbox"},{name:"protonmail",domains:["pm.me","protonmail.com"],inboxUrl:"https://mail.proton.me/u/0/inbox"}];var g=e=>new Promise(o=>setTimeout(o,e));async function l(e="",o={}){if(t.dryRun)return await g(1e3),{dummyData:!0};try{let r=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok)throw new Error("Network response was not OK");return r.json()}catch(r){return console.error("There has been a problem with your fetch operation:",r),!1}}function h(e,o){let n=o.split("@")[1],i=S.find(m=>m.domains.includes(n)),a=e.innerHTML,s;i===void 0?s=document.createElement("span"):(s=document.createElement("a"),s.setAttribute("href",i.inboxUrl),s.setAttribute("target","_blank")),s.setAttribute("class","inbox-link"),s.innerHTML=a,e.replaceWith(s)}function y(e,o,r,n){e&&e.setAttribute("disabled",""),o&&o.classList.remove(t.hiddenClass),r&&r.classList.add(t.hiddenClass),n&&n.classList.add(t.hiddenClass)}function L(e,o){e&&e.removeAttribute("disabled"),o&&o.classList.add(t.hiddenClass)}function x(e,o){let r=e.getAttribute("action"),n=new FormData(o),i={};n.forEach((c,b)=>{i[b]=c});let a=n.get("email");if(!a)return;let s=document.querySelector(t.formSelector+' [type="submit"]'),m=document.querySelector(t.formSuccessMsgSelector),f=document.querySelector(t.formErrorMsgSelector),d=document.querySelector(t.formInboxLinkSelector),p=document.querySelector(t.formSpinnerSelector);y(s,p,m,f),l(r,i).then(c=>{c?m?(d&&h(d,a),m.classList.remove(t.hiddenClass),e.reset()):console.log("Signup successful!",c):f&&f.classList.remove(t.hiddenClass),L(s,p)})}var u=document.querySelector(t.formSelector);u&&u.addEventListener("submit",e=>{e.preventDefault(),x(u,e.target)});if(t.confirmationPathname&&window.location.pathname===t.confirmationPathname){let e=window.location.search,r=new URLSearchParams(e).get("jwt"),n=document.querySelector(t.confirmErrorMsgSelector);if(r&&t.apiHost){let i=`${t.apiHost}/v1/form/confirm/${r}`;l(i).then(a=>{a||n&&n.classList.remove(t.hiddenClass)})}}
